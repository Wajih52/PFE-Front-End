<!-- src/app/features/auth/pages/reset-password/reset-password.component.html -->

<div class="reset-password-container">
  <div class="reset-password-card">

    <!-- Header -->
    <div class="header">
      <h1>🔑 Nouveau mot de passe</h1>
      <p>Choisissez un nouveau mot de passe sécurisé</p>
    </div>

    <!-- Message de succès -->
    <div class="success-message" *ngIf="successMessage">
      {{ successMessage }}
      <p class="info">Redirection vers la page de connexion...</p>
    </div>

    <!-- Message d'erreur -->
    <div class="error-message" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <!-- Lien expiré -->
    <div *ngIf="!tokenValid" class="expired-link">
      <p>⏰ Le lien de réinitialisation a expiré ou est invalide.</p>
      <a routerLink="/auth/forgot-password" class="btn-retry">
        Demander un nouveau lien
      </a>
    </div>

    <!-- Formulaire -->
    <form
      [formGroup]="resetPasswordForm"
      (ngSubmit)="onSubmit()"
      *ngIf="tokenValid && !successMessage"
    >

      <!-- Nouveau mot de passe -->
      <div class="form-group">
        <label for="nouveauMotDePasse">
          Nouveau mot de passe <span class="required">*</span>
        </label>
        <div class="password-wrapper">
          <input
            [type]="showPassword ? 'text' : 'password'"
            id="nouveauMotDePasse"
            formControlName="nouveauMotDePasse"
            placeholder="Min 8 caractères (1 maj, 1 min, 1 chiffre, 1 spécial)"
            [class.error]="hasError('nouveauMotDePasse')"
          />
          <button
            type="button"
            class="toggle-password"
            (click)="togglePasswordVisibility('password')"
          >
            {{ showPassword ? '🙈' : '👁️' }}
          </button>
        </div>
        <span class="error-text" *ngIf="hasError('nouveauMotDePasse')">
          {{ getErrorMessage('nouveauMotDePasse') }}
        </span>
      </div>

      <!-- Confirmer mot de passe -->
      <div class="form-group">
        <label for="confirmMotDePasse">
          Confirmer le mot de passe <span class="required">*</span>
        </label>
        <div class="password-wrapper">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmMotDePasse"
            formControlName="confirmMotDePasse"
            placeholder="Retapez le mot de passe"
            [class.error]="hasError('confirmMotDePasse') || hasFormError('passwordMismatch')"
          />
          <button
            type="button"
            class="toggle-password"
            (click)="togglePasswordVisibility('confirm')"
          >
            {{ showConfirmPassword ? '🙈' : '👁️' }}
          </button>
        </div>
        <span class="error-text" *ngIf="hasError('confirmMotDePasse')">
          {{ getErrorMessage('confirmMotDePasse') }}
        </span>
        <span class="error-text" *ngIf="hasFormError('passwordMismatch')">
          ⚠️ Les mots de passe ne correspondent pas
        </span>
      </div>

      <!-- Exigences du mot de passe -->
      <div class="password-requirements">
        <p><strong>Votre mot de passe doit contenir :</strong></p>
        <ul>
          <li>Au moins 8 caractères</li>
          <li>Une lettre majuscule</li>
          <li>Une lettre minuscule</li>
          <li>Un chiffre</li>
          <li>Un caractère spécial ($!%*?&.#_-)</li>
        </ul>
      </div>

      <!-- Bouton de soumission -->
      <button
        type="submit"
        class="btn-submit"
        [disabled]="isLoading"
      >
        <span *ngIf="!isLoading">Réinitialiser le mot de passe</span>
        <span *ngIf="isLoading">Réinitialisation...</span>
      </button>

      <!-- Lien retour connexion -->
      <div class="back-to-login">
        <a routerLink="/auth/login">← Retour à la connexion</a>
      </div>
    </form>

  </div>
</div>
