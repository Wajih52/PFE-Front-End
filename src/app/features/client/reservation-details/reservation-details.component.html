<!-- src/app/features/client/reservation-details/reservation-details.component.html -->
<div class="reservation-details-container">
  <!-- Loader -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loader"></div>
      <p>Chargement des d√©tails...</p>
    </div>
  }

  <!-- Messages -->
  @if (successMessage()) {
    <div class="alert alert-success">
      <i class="fas fa-check-circle"></i>
      {{ successMessage() }}
    </div>
  }

  @if (errorMessage()) {
    <div class="alert alert-error">
      <i class="fas fa-exclamation-triangle"></i>
      {{ errorMessage() }}
    </div>
  }

  <!-- Contenu principal -->
  @if (!isLoading() && reservation();as res) {
    <!-- Header -->
    <div class="details-header">
      <button class="btn-back" (click)="retourListeCommandes()">
        <i class="fas fa-arrow-left"></i>
        Retour
      </button>

      <div class="header-content">
        <div>
          <h1>{{ res.referenceReservation }}</h1>
          <p class="date-creation">Cr√©√©e le {{ formatDateTime(res.dateCreation) }}</p>
        </div>
        <span
          class="badge"
          [ngClass]="getStatutBadgeClass(res.statutReservation)"
        >
          {{ statutLabels[res.statutReservation] }}
        </span>
      </div>
    </div>

    <div class="details-content">
      <!-- Colonne gauche: Informations g√©n√©rales -->
      <div class="left-column">
        <!-- Informations client -->
        <div class="info-card">
          <h2>
            <i class="fas fa-user"></i>
            Informations client
          </h2>
          <div class="info-grid">
            <div class="info-item">
              <span class="label">Nom complet</span>
              <span class="value">{{ res.prenomClient }} {{ res.nomClient }}</span>
            </div>
            <div class="info-item">
              <span class="label">Email</span>
              <span class="value">{{ res.emailClient }}</span>
            </div>
            <div class="info-item">
              <span class="label">T√©l√©phone</span>
              <span class="value">{{ res.telephoneClient }}</span>
            </div>
          </div>
        </div>

        <!-- Informations de l'√©v√©nement -->
        <div class="info-card">
          <h2>
            <i class="fas fa-calendar-alt"></i>
            Dates de l'√©v√©nement
          </h2>
          <div class="event-dates">
            <div class="date-box">
              <span class="date-label">D√©but</span>
              <span class="date-value">{{ formatDate(res.dateDebut) }}</span>
            </div>
            <div class="arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
            <div class="date-box">
              <span class="date-label">Fin</span>
              <span class="date-value">{{ formatDate(res.dateFin) }}</span>
            </div>
          </div>
          <div class="duration-badge">
            <i class="fas fa-clock"></i>
            {{ res.joursLocation }} jour(s) de location
          </div>
        </div>

        <!-- Montants -->
        <div class="info-card">
          <h2>
            <i class="fas fa-calculator"></i>
            R√©capitulatif financier
          </h2>
          <div class="montants-grid">
            <div class="montant-row">
              <span class="label">Montant Total</span>
              <span class="value">
                {{ getPrixIntermediaire(res.montantTotal,res.remisePourcentage,res.remiseMontant) | number:'1.2-2' }} DT
              </span>
            </div>

            @if (res.remisePourcentage || res.remiseMontant) {
              <div class="montant-row remise">
                <span class="label">
                  <i class="fas fa-tag"></i>
                  Remise
                </span>
                <span class="value">
                  @if (res.remisePourcentage) {
                    -{{ res.remisePourcentage }}%
                  }
                  @if (res.remiseMontant) {
                    -{{ res.remiseMontant | number:'1.2-2' }} DT
                  }
                </span>
              </div>
            }

            <div class="montant-row total">
              <span class="label">Montant Final</span>
              <span class="value highlight">{{ res.montantTotal | number:'1.2-2' }} DT</span>
            </div>

            @if (res.montantPaye && res!.montantPaye > 0) {
              <div class="montant-row">
                <span class="label">Montant pay√©</span>
                <span class="value success">{{ reservation()?.montantPaye | number:'1.2-2' }} DT</span>
              </div>

              <div class="montant-row">
                <span class="label">Reste √† payer</span>
                <span class="value" [class.success]="res.paiementComplet" [class.alert]="!res.paiementComplet">
                  {{ res.montantRestant | number:'1.2-2' }} DT
                </span>
              </div>
            }
          </div>

          @if (!res.paiementComplet) {
            <div class="payment-alert">
              <i class="fas fa-exclamation-circle"></i>
              <span>Paiement incomplet - {{ res.montantRestant | number:'1.2-2' }} DT restant</span>
            </div>
          }
        </div>

        <!-- Commentaires -->
        @if (res.commentaireAdmin || res.observationsClient) {
          <div class="info-card">
            <h2>
              <i class="fas fa-comment"></i>
              Observations
            </h2>

            @if (res.commentaireAdmin) {
              <div class="commentaire admin">
                <div class="commentaire-header">
                  <i class="fas fa-user-tie"></i>
                  Message de l'agence
                </div>
                <p class="commentaire-text">{{ res.commentaireAdmin }}</p>
              </div>
            }

            @if (res.observationsClient) {
              <div class="commentaire client">
                <div class="commentaire-header">
                  <i class="fas fa-user"></i>
                   observations Client
                </div>
                <p class="commentaire-text">{{ res.observationsClient }}</p>
              </div>
            }
          </div>
        }

        <!-- Actions -->
        <div class="actions-card">
          @if (peutModifier()) {
            <button class="btn btn-primary" (click)="ouvrirModalDecalage()">
              <i class="fas fa-calendar-plus"></i>
              D√©caler toutes les dates
            </button>
          }

          @if (peutAnnuler()) {
            <button class="btn btn-danger" (click)="ouvrirModalAnnuler()">
              <i class="fas fa-times-circle"></i>
              Annuler la r√©servation
            </button>
          }
          <!-- Bouton pour effectuer un paiement -->
          @if (res.montantTotal-(res.montantPaye??0) > 0) {
            <div class="paiement-action">
              <button class="btn-paiement"
                [routerLink]="['/reservations', reservation()?.idReservation,'ajouter-paiement']">
                <i class="fas fa-credit-card"></i>
                Effectuer un paiement
              </button>
            </div>
          }
        </div>
      </div>

      <!-- Colonne droite: Liste des produits -->
      <div class="right-column">
        <div class="produits-card">
          <h2>
            <i class="fas fa-box"></i>
            Produits r√©serv√©s ({{ res.nombreProduits }})
          </h2>
          @if (peutModifier()) {
            <button class="btn btn-primary " (click)="ouvrirModalAjouterLigne()">
              <i class="fas fa-plus"></i>
              Ajouter un produit
            </button>
          }
          <br>
          <div class="produits-list">
            @for (ligne of res.lignesReservation; track ligne.idLigneReservation) {
              <div class="produit-item">
                <!-- Image -->
                @if (ligne.imageProduit) {
                  <div class="produit-image">
                    <img [src]="getImageUrl(ligne)" [alt]="ligne.nomProduit" />
                  </div>
                } @else {
                  <div class="produit-image placeholder">
                    <i class="fas fa-image"></i>
                  </div>
                }

                <!-- Infos -->
                <div class="produit-info">
                  <h3>{{ ligne.nomProduit }}</h3>
                  @if (ligne.codeProduit) {
                    <p class="code">Ref: {{ ligne.codeProduit }}</p>
                  }

                  <div class="produit-details">
                    <div class="detail-item">
                      <i class="fas fa-boxes"></i>
                      <span>Quantit√©: {{ ligne.quantite }}</span>
                    </div>
                    <div class="detail-item">
                      <i class="fas fa-tag"></i>
                      <span>{{ ligne.prixUnitaire | number:'1.2-2' }} DT/unit√©</span>
                    </div>
                  </div>

                  <div class="dates-produit">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Du {{ formatDate(ligne.dateDebut) }} au {{ formatDate(ligne.dateFin) }}
                    ({{ calculerJours(ligne.dateDebut, ligne.dateFin) }} jours)
                    </span>
                  </div>

                  @if (ligne.numerosSeries && ligne.numerosSeries.length > 0) {
                    <div class="series-numbers">
                      <i class="fas fa-barcode"></i>
                      <div class="series-content">
                      <span class="series-label">N¬∞ de s√©rie:</span>
                      <span class="series-list">{{ ligne.numerosSeries.join('\n') }}</span>
                      </div>
                    </div>
                  }

                  <div class="produit-montant">
                    Sous-total: <strong>{{ (ligne.sousTotal * calculerJours(ligne.dateDebut, ligne.dateFin)| number:'1.2-2')  }} DT</strong>
                  </div>

                  @if (peutModifier()) {
                    <div class="actions-ligne">
                    <button
                      class="btn btn-icon btn-edit"
                      (click)="ouvrirModalEditerLigne(ligne)"
                      title="Modifier quantit√©/dates">
                      <i class="fas fa-edit"></i>
                      Modifier
                    </button>
                    <button
                      class="btn-modifier-ligne"
                      (click)="ouvrirModalModifierLigne(ligne)"
                    >
                      <i class="fas fa-edit"></i>
                      Modifier les dates
                    </button>
                    <button
                      class="btn btn-icon btn-delete"
                      (click)="ouvrirModalSupprimerLigne(ligne)"
                      title="Supprimer">
                      <i class="fas fa-trash-alt"></i>
                      Supprimer
                    </button>
                    </div>
                  }

                </div>
              </div>
            }
          </div>
        </div>
      </div>

    </div>
  }
  <div class="detail-section factures-section">
    <h2>
      <i class="fas fa-file-invoice"></i>
      Factures
    </h2>

    @if (loadingFactures()) {
      <div class="loading-factures">
        <div class="spinner"></div>
        <p>Chargement des factures...</p>
      </div>
    }

    @if (!loadingFactures() && factures().length > 0) {
      <div class="factures-grid">
        @for (facture of factures(); track facture.idFacture) {
          <div class="facture-card">
            <div class="facture-header">
              <span class="facture-numero">{{ facture.numeroFacture }}</span>
              <span [class]="'badge badge-' + facture.typeFacture.toLowerCase()">
              {{ facture.typeFacture }}
            </span>
            </div>

            <div class="facture-body">
              <div class="facture-info-row">
                <span class="label">Date:</span>
                <span class="value">{{ facture.dateCreation | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="facture-info-row">
                <span class="label">Montant HT:</span>
                <span class="value">{{ facture.montantHT | number:'1.2-2' }} DT</span>
              </div>
              <div class="facture-info-row">
                <span class="label">TVA:</span>
                <span class="value">{{ facture.montantTVA | number:'1.2-2' }} DT</span>
              </div>
              <div class="facture-info-row total">
                <span class="label">Total TTC:</span>
                <span class="value">{{ facture.montantTTC | number:'1.2-2' }} DT</span>
              </div>
            </div>

            <div class="facture-actions">
              <button
                class="btn btn-primary btn-sm"
                (click)="voirDetailFacture(facture)"
              >
                <i class="fas fa-eye"></i>
                D√©tails
              </button>
              <button
                class="btn btn-secondary btn-sm"
                (click)="telechargerFacture(facture)"
              >
                <i class="fas fa-download"></i>
                PDF
              </button>
            </div>
          </div>
        }
      </div>
    }

    @if (!loadingFactures() && factures().length === 0) {
      <div class="no-factures">
        <i class="fas fa-file-invoice"></i>
        <p>Aucune facture n'a encore √©t√© g√©n√©r√©e pour cette r√©servation</p>
      </div>
    }
  </div>
</div>

<!-- Modal D√©calage Global -->
@if (showDecalageModal()) {
  <div class="modal-overlay" (click)="fermerModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="fas fa-calendar-plus"></i>
          D√©caler toutes les dates
        </h2>
        <button class="btn-close" (click)="fermerModals()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <p>Indiquez le nombre de jours de d√©calage. Un nombre positif avance les dates, un nombre n√©gatif les recule.</p>

        <div class="form-group">
          <label for="nombreJours">
            <i class="fas fa-calendar-day"></i>
            Nombre de jours
          </label>
          <input
            type="number"
            id="nombreJours"
            [(ngModel)]="nombreJoursDecalage"
            placeholder="Ex: 7 pour avancer d'une semaine, -7 pour reculer"
            class="form-input"
          />
          <small>Exemple: +7 pour reporter d'une semaine, -3 pour avancer de 3 jours</small>
        </div>

        <div class="form-group">
          <label for="motifDecalage">
            <i class="fas fa-comment"></i>
            Motif (obligatoire)
          </label>
          <textarea
            id="motifDecalage"
            [(ngModel)]="motifDecalage"
            rows="3"
            placeholder="Ex: M√©t√©o, changement de planning, etc."
            class="form-textarea"
          ></textarea>
        </div>

        <div class="info-message">
          <i class="fas fa-info-circle"></i>
          <p>Le syst√®me v√©rifiera automatiquement la disponibilit√© pour toutes les nouvelles dates.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fermerModals()">Annuler</button>
        <button class="btn btn-primary" (click)="decalerToutesLesLignes()">
          <i class="fas fa-check"></i>
          Confirmer le d√©calage
        </button>
      </div>
    </div>
  </div>
}

<!-- Modal Modifier une Ligne -->
@if (showModifierLigneModal() && ligneSelectionnee()) {
  <div class="modal-overlay" (click)="fermerModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="fas fa-edit"></i>
          Modifier {{ ligneSelectionnee()!.nomProduit }}
        </h2>
        <button class="btn-close" (click)="fermerModals()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="dates-actuelles">
          <h3>Dates actuelles</h3>
          <p>Du {{ formatDate(ligneSelectionnee()!.dateDebut) }} au {{ formatDate(ligneSelectionnee()!.dateFin) }}</p>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="nouvelleDateDebut">
              <i class="fas fa-calendar-day"></i>
              Nouvelle date de d√©but
            </label>
            <input
              type="date"
              id="nouvelleDateDebut"
              [(ngModel)]="nouvelleDateDebut"
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label for="nouvelleDateFin">
              <i class="fas fa-calendar-day"></i>
              Nouvelle date de fin
            </label>
            <input
              type="date"
              id="nouvelleDateFin"
              [(ngModel)]="nouvelleDateFin"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="motifModifLigne">
            <i class="fas fa-comment"></i>
            Motif (optionnel)
          </label>
          <textarea
            id="motifModifLigne"
            [(ngModel)]="motifModifLigne"
            rows="2"
            placeholder="Raison de la modification"
            class="form-textarea"
          ></textarea>
        </div>

        <div class="info-message">
          <i class="fas fa-info-circle"></i>
          <p>Le montant sera recalcul√© automatiquement selon la nouvelle dur√©e.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fermerModals()">Annuler</button>
        <button class="btn btn-primary" (click)="modifierUneLigne()">
          <i class="fas fa-check"></i>
          Enregistrer
        </button>
      </div>
    </div>
  </div>
}

<!-- Modal Annulation -->
@if (showAnnulerModal()) {
  <div class="modal-overlay" (click)="fermerModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="fas fa-times-circle"></i>
          Annuler la r√©servation
        </h2>
        <button class="btn-close" (click)="fermerModals()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="warning-message">
          <i class="fas fa-exclamation-triangle"></i>
          <p>
            Vous √™tes sur le point d'annuler la r√©servation
            <strong>{{ reservation()!.referenceReservation }}</strong>.
            Cette action est irr√©versible.
          </p>
        </div>

        <div class="form-group">
          <label for="motifAnnulation">
            <i class="fas fa-comment"></i>
            Motif de l'annulation (optionnel)
          </label>
          <textarea
            id="motifAnnulation"
            [(ngModel)]="motifAnnulation"
            rows="3"
            placeholder="Ex: Changement de plans, √©v√©nement annul√©, etc."
            class="form-textarea"
          ></textarea>
        </div>

        <div class="info-message">
          <i class="fas fa-info-circle"></i>
          <p>Le stock sera automatiquement lib√©r√© et redevient disponible.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fermerModals()">Non, garder la r√©servation</button>
        <button class="btn btn-danger" (click)="annulerReservation()">
          <i class="fas fa-times"></i>
          Oui, annuler d√©finitivement
        </button>
      </div>
    </div>
  </div>
}
<!-- ============================================ -->
<!-- üÜï Modal Ajouter une Ligne -->
<!-- ============================================ -->
@if (showAjouterLigneModal()) {
  <div class="modal-overlay" (click)="fermerModals()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="fas fa-plus-circle"></i>
          Ajouter un produit
        </h2>
        <button class="btn-close" (click)="fermerModals()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        @if (errorMessage()) {
          <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle"></i>
            {{ errorMessage() }}
          </div>
        }

        <div class="form-group">
          <label for="produit">
            <i class="fas fa-box"></i>
            Produit <span class="required">*</span>
          </label>
          <select
            id="produit"
            [(ngModel)]="formulaireLigne().idProduit"
            class="form-input"
            required
          >
            <option [value]="0">-- S√©lectionnez un produit --</option>
            @for (produit of produitsDisponibles(); track produit.idProduit) {
              <option [value]="produit.idProduit">
                {{ produit.nomProduit }} - {{ produit.prixUnitaire }} TND/jour
                  (Stock: {{ produit.quantiteDisponible }})
              </option>
            }
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="quantiteAjout">
              <i class="fas fa-hashtag"></i>
              Quantit√© <span class="required">*</span>
            </label>
            <input
              type="number"
              id="quantiteAjout"
              [(ngModel)]="formulaireLigne().quantite"
              min="1"
              class="form-input"
              required
            />
          </div>

          <div class="form-group">
            <label>Dur√©e</label>
            <div class="info-box">
              <i class="fas fa-calendar-day"></i>
              {{ calculerJours(formulaireLigne().dateDebut, formulaireLigne().dateFin) }} jours
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="dateDebutAjout">
              <i class="fas fa-calendar-day"></i>
              Date de d√©but <span class="required">*</span>
            </label>
            <input
              type="date"
              id="dateDebutAjout"
              [(ngModel)]="formulaireLigne().dateDebut"
              (change)="onDatesChange()"
              class="form-input"
              required
            />
          </div>

          <div class="form-group">
            <label for="dateFinAjout">
              <i class="fas fa-calendar-day"></i>
              Date de fin <span class="required">*</span>
            </label>
            <input
              type="date"
              id="dateFinAjout"
              [(ngModel)]="formulaireLigne().dateFin"
              (change)="onDatesChange()"
              class="form-input"
              required
            />
          </div>
        </div>

        <div class="form-group">
          <label for="observationsAjout">
            <i class="fas fa-comment"></i>
            Observations (optionnel)
          </label>
          <textarea
            id="observationsAjout"
            [(ngModel)]="formulaireLigne().observations"
            rows="3"
            placeholder="Remarques particuli√®res..."
            class="form-textarea"
          ></textarea>
        </div>

        <div class="info-message">
          <i class="fas fa-info-circle"></i>
          <p>
            Le syst√®me v√©rifiera automatiquement la disponibilit√© du produit
            pour les dates s√©lectionn√©es avant d'ajouter la ligne.
          </p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fermerModals()">
          <i class="fas fa-times"></i>
          Annuler
        </button>
        <button class="btn btn-primary" (click)="ajouterNouvelleLigne()">
          <i class="fas fa-plus"></i>
          Ajouter La ligne
        </button>
      </div>
    </div>
  </div>
}

<!-- ============================================ -->
<!-- üÜï Modal √âditer une Ligne (Quantit√©/Dates/Obs) -->
<!-- ============================================ -->
@if (showEditerLigneModal()) {
  <div class="modal-overlay" (click)="fermerModals()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="fas fa-edit"></i>
          Modifier "{{ ligneSelectionnee()?.nomProduit }}"
        </h2>
        <button class="btn-close" (click)="fermerModals()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        @if (errorMessage()) {
          <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle"></i>
            {{ errorMessage() }}
          </div>
        }

        <div class="current-info">
          <h4>üì¶ Informations actuelles</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="label">Quantit√©:</span>
              <span class="value">{{ ligneSelectionnee()?.quantite }}</span>
            </div>
            <div class="info-item">
              <span class="label">Prix unitaire:</span>
              <span class="value">{{ ligneSelectionnee()?.prixUnitaire }} TND/jour</span>
            </div>
            <div class="info-item">
              <span class="label">Dates:</span>
              <span class="value">
                {{ formatDate(ligneSelectionnee()!.dateDebut) }} au {{ formatDate(ligneSelectionnee()!.dateFin) }}
              </span>
            </div>
            <div class="info-item">
              <span class="label">Sous-total:</span>
              <span class="value">{{ ligneSelectionnee()?.sousTotal }} TND</span>
            </div>
          </div>
        </div>

        <h4>‚úèÔ∏è Nouvelles valeurs</h4>

        <div class="form-row">
          <div class="form-group">
            <label for="quantiteEdit">
              <i class="fas fa-hashtag"></i>
              Nouvelle quantit√© <span class="required">*</span>
            </label>
            <input
              type="number"
              id="quantiteEdit"
              [(ngModel)]="formulaireLigne().quantite"
              min="1"
              class="form-input"
              required
            />
          </div>

          <div class="form-group">
            <label>Nouvelle dur√©e</label>
            <div class="info-box">
              <i class="fas fa-calendar-day"></i>
              {{ calculerJours(formulaireLigne().dateDebut, formulaireLigne().dateFin) }} jours
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="dateDebutEdit">
              <i class="fas fa-calendar-day"></i>
              Nouvelle date de d√©but <span class="required">*</span>
            </label>
            <input
              type="date"
              id="dateDebutEdit"
              [(ngModel)]="formulaireLigne().dateDebut"
              class="form-input"
              required
            />
          </div>

          <div class="form-group">
            <label for="dateFinEdit">
              <i class="fas fa-calendar-day"></i>
              Nouvelle date de fin <span class="required">*</span>
            </label>
            <input
              type="date"
              id="dateFinEdit"
              [(ngModel)]="formulaireLigne().dateFin"
              class="form-input"
              required
            />
          </div>
        </div>

        <div class="form-group">
          <label for="observationsEdit">
            <i class="fas fa-comment"></i>
            Observations
          </label>
          <textarea
            id="observationsEdit"
            [(ngModel)]="formulaireLigne().observations"
            rows="3"
            placeholder="Remarques particuli√®res..."
            class="form-textarea"
          ></textarea>
        </div>

        <div class="info-message">
          <i class="fas fa-info-circle"></i>
          <p>
            Le montant total sera recalcul√© automatiquement en fonction
            des nouvelles quantit√©s et dates.
          </p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fermerModals()">
          <i class="fas fa-times"></i>
          Annuler
        </button>
        <button class="btn btn-primary" (click)="enregistrerModificationLigne()">
          <i class="fas fa-save"></i>
          Enregistrer les modifications
        </button>
      </div>
    </div>
  </div>
}

<!-- ============================================ -->
<!-- üÜï Modal Supprimer une Ligne -->
<!-- ============================================ -->
@if (showSupprimerLigneModal()) {
  <div class="modal-overlay" (click)="fermerModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="fas fa-trash-alt"></i>
          Supprimer la ligne
        </h2>
        <button class="btn-close" (click)="fermerModals()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="warning-message">
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <p>
              √ätes-vous s√ªr de vouloir supprimer cette ligne ?
            </p>
            <div class="ligne-info">
              <strong>{{ ligneSelectionnee()?.nomProduit }}</strong>
              <div class="details">
                <span>Quantit√©: {{ ligneSelectionnee()?.quantite }}</span>
                <span>Sous-total: {{ ligneSelectionnee()?.sousTotal }} TND</span>
              </div>
            </div>
          </div>
        </div>

        <div class="info-message">
          <i class="fas fa-info-circle"></i>
          <p>
            Le montant total de la r√©servation sera automatiquement recalcul√©
            apr√®s la suppression.
          </p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fermerModals()">
          <i class="fas fa-times"></i>
          Annuler
        </button>
        <button class="btn btn-danger" (click)="confirmerSuppressionLigne()">
          <i class="fas fa-trash-alt"></i>
          Confirmer la suppression
        </button>
      </div>
    </div>
  </div>
}

